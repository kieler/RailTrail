# "inspired" by https://github.com/alexeagleson/docker-node-postgres-template/blob/master/docker-compose.yml
version: '3'
services:
  backend:
    build: .
    working_dir: /app
    links:
      - postgres
    ports:
      - "8080:8080"
    environment:
      # See https://stackoverflow.com/questions/33357567/econnrefused-for-postgres-on-nodejs-with-dockers
      - POSTGRES_HOST=postgres
      - POSTGRES_USER=railtrail_user
      - POSTGRES_DB=railtrail
      - POSTGRES_PASSWORD=root
      - POSTGRES_PORT=5432
    volumes:
      - ./:/app/
      # node_modules workaround for volumes
      # https://stackoverflow.com/a/32785014
      - /app/node_modules

  postgres:
    image: postgres:14.1-alpine
    restart: always
    environment:
      # set env-variables for config of postgres
      - POSTGRES_USER=railtrail_user
      - POSTGRES_PASSWORD=root # CHANGE THIS!
      - POSTGRES_DB=railtrail
      - POSTGRES_HOST=postgres
    # we may not need any ports here if we do not want access from the outside
    # (the postgres image exposes 5432, so the nodejs-app should still be able to connect)
    ports:
      # Standard port for PostgreSQL databases
      - "5432:5432"
    #volumes:
      # This could be used for initialization purposes
      #- ./database-install.sql:/docker-entrypoint-initdb.d/database-install.sql
